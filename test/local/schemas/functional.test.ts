import { FunctionalSchema } from "@brink-sdk/intents/schemas/functional";
import { DeclarationArgs } from "@brinkninja/types";
import { expect } from 'chai';


describe('FunctionalSchema', () => {
  it('should validate a valid declaration', () => {
    const { error } = FunctionalSchema.validate(declarationArgs);
    expect(error).to.be.undefined;
  });

  it('should throw meaningful error for invalid segment params', () => {
    let value = declarationArgs
    // @ts-ignore
    value.intents[0].segments[0].params = { index: '0' }; // missing value
    const { error } = FunctionalSchema.validate(value);
    expect(error.message).to.match(/"intents\[0\].segments\[0\].params.value" is required/);
  });
});


const declarationArgs = {
		'segmentsContract': '0x79f147176824196789f07dfc2d21e100ee1ae138',
		'intents': [
			{
				'segments': [
					{
						'data': '0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000044a9aa5f7e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000',
						'functionName': 'useBit',
						'params': {
							'index': '0',
							'value': '1'
						},
						'requiresUnsignedCall': false
					},
					{
						'data': '0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000024502929ff00000000000000000000000000000000000000000000000000009a761dfdf10000000000000000000000000000000000000000000000000000000000',
						'functionName': 'requireBlockNotMined',
						'params': {
							'blockNumber': '169832100000000'
						},
						'requiresUnsignedCall': false
					},
					{
						'data': '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c42b2fc43a0000000000000000000000003b28d6ee052b65ed4d5230c1b2a9abaef031c648000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f564000000000000000000000000000000000000000000000000000000000000003e800000000000000000000000000000000000000000000000000000000',
						'functionName': 'requireUint256LowerBound',
						'params': {
							'oracle': {
								'address': '0x3b28d6ee052b65Ed4d5230c1B2A9AbaEF031C648',
								'params': '0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f564000000000000000000000000000000000000000000000000000000000000003e8'
							},
							'lowerBound': '79228162514264337593543950336000'
						},
						'requiresUnsignedCall': false
					},
					{
						'data': '0x00000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000002a449d9a2180000000000000000000000003b28d6ee052b65ed4d5230c1b2a9abaef031c64800000000000000000000000000000000000000000000000000000000000002200000000000000000000000006399ae010188f36e469fb6e62c859ddfc558328a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000dac17f958d2ee523a2206206994597c13d831ec70000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a0b86991c6218b36c1d19d4a2e9eb0ce3606eb4800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000566d3e80000000000000000000000000000000000000000000000000000000000000271000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280000000000000000000000000000000000000000000000000000000000000004000000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f564000000000000000000000000000000000000000000000000000000000000003e8000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
						'functionName': 'marketSwapExactInput',
						'params': {
							'oracle': {
								'address': '0x3b28d6ee052b65Ed4d5230c1B2A9AbaEF031C648',
								'params': '0x00000000000000000000000088e6a0c2ddd26feeb64f039a2c41296fcb3f564000000000000000000000000000000000000000000000000000000000000003e8'
							},
							'signer': '0x6399ae010188F36e469FB6E62C859dDFc558328A',
							'tokenIn': {
								'address': '0xdac17f958d2ee523a2206206994597c13d831ec7',
								'standard': 0,
								'idsMerkleRoot': '0x0000000000000000000000000000000000000000000000000000000000000000',
								'id': '0',
								'disallowFlagged': false
							},
							'tokenOut': {
								'address': '0xa0b86991c6218b36c1d19d4a2e9eb0ce3606eb48',
								'standard': 0,
								'idsMerkleRoot': '0x0000000000000000000000000000000000000000000000000000000000000000',
								'id': '0',
								'disallowFlagged': false
							},
							'tokenInAmount': '1450000000',
							'feePercent': '10000',
							'feeMin': '0'
						},
						'requiresUnsignedCall': true
					}
				]
			}
		],
		'beforeCalls': [],
		'afterCalls': []
	}
